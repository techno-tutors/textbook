name: Weekly mdBook linkcheck

on:
  schedule:
    - cron: '0 0 * * 0'   # 週1回 (UTC 日曜 00:00)。必要なら cron を調整してください
  workflow_dispatch:

permissions:
  contents: read

jobs:
  linkcheck:
    runs-on: ubuntu-latest
    env:
      MDBOOK_VERSION: 0.5.2
    steps:
      - name: Checkout
        uses: actions/checkout@v6.0.1
      - name: Install mdBook and mdbook-linkcheck
        run: |
          mkdir bin
          curl -sSL https://github.com/rust-lang/mdBook/releases/download/v${MDBOOK_VERSION}/mdbook-v${MDBOOK_VERSION}-x86_64-unknown-linux-gnu.tar.gz | tar -xz --directory=bin
          
          curl -L https://github.com/Michael-F-Bryan/mdbook-linkcheck/releases/latest/download/mdbook-linkcheck.x86_64-unknown-linux-gnu.zip -o bin/mdbook-linkcheck.zip
          unzip bin/mdbook-linkcheck.zip -d bin && chmod +x bin/mdbook-linkcheck

      - name: Build book (runs linkcheck)
        run: |
          export PATH=$PWD/bin:$PATH
          bin/mdbook build
        env:
          RUST_LOG: info
